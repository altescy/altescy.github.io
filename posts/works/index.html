<!doctype html><html><head><title>Works</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/logo_trans.png><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/layouts/list.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/logo_trans.png>altescy</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/logo_trans.png class=d-none id=main-logo>
<img src=/images/logo_trans.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/hello/>Hello, World!</a></li><li><a href=/posts/diary/>Diary</a></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/works/>Works</a><ul class=active><li><a href=/posts/works/bookshelf/>電子書籍をオンライン管理する</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid post-card-holder" id=post-card-holder><div class=post-card><a href=/posts/works/bookshelf/ class=post-card-link><div class=card><div class=card-head><img class=card-img-top src=/images/posts/works/bookshelf/hero.jpg></div><div class=card-body><h5 class=card-title>電子書籍をオンライン管理する</h5><p class="card-text post-summary">はじめに 最近，書籍を電子版で購入することが増えたことで電子書籍の管理が煩雑になってきました． 多くの場合，電子書籍を購入すると販売サイトから書籍データをダウンロードできて， それらを自分の端末に入れて読むことになります．また，一つの書籍に対してPDFやEPUB など複数のフォーマットが用意されていることも多いです．本を購入するたびに増えていく ファイルを効率よく管理するために，先日Bookshelf という電子書籍管理のためのWEBアプリをつくりました．
これまでは電子書籍の管理のためにDropboxやGoogle Driveなどのクラウドストレージに ファイルを突っ込んでいたのですが，ファイルへのアクセスが面倒であったり， ストレージの容量を気にする必要があったりと不満を感じていました． Bookshelfにはこうした問題を解決するための 機能を実装しました．
Bookshelf Bookshelfは電子書籍を管理するための WEBアプリであり，フロントエンドはVue.js + TypeScript, バックエンドはGo言語で 実装されています．主な特徴は以下のとおりです:
書籍情報の登録 OPDSフィードの配信 複数フォーマットの登録 S3互換ストレージへの保存 シングルバイナリ 書籍のメタ情報はPostgresかSQLite3に，書籍ファイルはローカルのファイルシステムか S3互換のオブジェクトストレージに保存することができます．また，本やファイルの 追加や削除はすべてブラウザから行えます．
書籍情報の登録 Bookshelfでは書籍データを保存する際に 著者や出版社，表紙などの書籍情報を合わせて登録します．書籍情報を登録する際は ISBNを入力すると自動的に他のフィールドを補完するため，効率よく書籍を登録する ことができます．登録された書籍情報は書籍へのアクセスの利便性を上げるだけでなく， 後述するOPDSフィードの配信にも使われます．
ISBNによる補完にはopenBDという検索APIを利用しています． 主要な書籍の情報はだいたい揃っていて，APIの仕様も簡潔なため非常に使いやすいです．
OPDSフィードの配信 電子書籍を配信するための規格としてOPDSというのがあるようです． あまり流行ってはいなさそうですが，日本ではオライリー・ジャパンや 青空文庫などでOPDSによるカタログの配信が行われて います．Bookshelfは登録した書籍をOPDSフォーマットで配信することができます． OPDSフィードへのリンクはヘッダー右側のアイコンから取得できます．
OPDSに対応したリーダーであれば，このアプリに登録した書籍をPCやスマートフォン から読むことができます．例えばFoliate というソフトウェアを使うと以下のように書籍の一覧を眺めたりファイルを ダウンロードしたりできます．このOPDS配信機能とOPDS対応リーダーのおかげで本への アクセスやローカルでの管理がかなり便利になりました．
複数フォーマットの登録 Bookshelfでは一つの書籍についてPDFやEPUBなど複数のフォーマットのファイルを 登録できます．ブラウザからは以下のように登録したファイルがアイコンとして表示 され，クリックするとファイルをダウンロードすることができます．
またOPDSでも複数のフォーマットを配信しているため，例えばFoliateからは以下の ようにプルダウンメニューからフォーマットを選択してダウンロードすることができます．
S3互換ストレージへの保存 書籍ファイルの保存先をS3互換のオブジェクトストレージに設定することができます． S3互換のストレージには本家のAWS S3やオープンソースのMinIO などがありますが，私はwasabiを使っています．wasabiは AWS S3に比べて非常にコスパがよく，API呼び出しや転送に対して課金されないため重宝 しています．(1TB未満なら$6/mo程度です．) これで容量をほとんど気にすることなく 電子書籍を管理できます！
シングルバイナリ Bookshelfはシングルバイナリで動作するアプリケーションです．今回，フロントエンド をバイナリファイルに含めるためにgo-bindata-assetfs を使ってみました．これを使うと任意のファイルをGoのコード中にバイナリとして埋め込む ことができます． 埋め込んだファイルは以下のようにhttp.</p></div><div class=card-footer><span class=float-left>September 26, 2020</span>
<a href=/posts/works/bookshelf/ class="float-right btn btn-outline-info btn-sm">Read</a></div></div></a></div></div><div class=paginator></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=/#achievements>Achievements</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact Me</h5><ul><li><span>Email:</span> <span>altescy@fastmail.com</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by Hugo
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script><script src=/assets/js/bootstrap.min.js></script><script src=/assets/js/navbar.js></script><script src=/assets/js/main.js></script><script src=/assets/js/list.js></script></body></html>